# Миграция архитектуры фронтенда: Feature-Sliced Design + Atomic Design

## Цель
Успешная миграция фронтенда на новую архитектуру согласно документации Qwen, обеспечивающая работоспособное, стабильное и поддерживаемое приложение. Эта задача направлена на корректное повторное внедрение предложенной архитектуры, извлекая уроки из предыдущих критических сбоев.

## Контекст
Предыдущая попытка Qwen реализовать Feature-Sliced Design (FSD) и Atomic Design привела к полностью нерабочему фронтенду, главным образом из-за преждевременного удаления рабочего кода, отсутствия проверки сборки и неустраненных проблем с импортами. Хотя документация Qwen по предложенной архитектуре отличная, выполнение требует более осторожного и итеративного подхода.

## Обзор предложенной архитектуры
Целевая архитектура включает:
*   **Feature-Sliced Design (FSD):** Организация проекта в `app/`, `processes/`, `pages/`, `widgets/`, `features/`, `entities/`, `shared/`.
*   **Atomic Design:** Внутри `shared/ui/` компоненты классифицируются как `atoms/`, `molecules/`, `organisms/`.
*   **Ключевые технологии:** SvelteKit 2, Svelte 5 (Runes API), TypeScript, Houdini (клиент GraphQL), TailwindCSS 4.

## Поэтапный план реализации

### Фаза 0: Стабилизация и подготовка проекта
**Цель:** Обеспечить стабильное, работоспособное состояние фронтенд-проекта перед началом миграции.
1.  **Оценка текущего состояния:** Проверить, является ли фронтенд в настоящее время функциональным. Если нет, определить и откатить/исправить любые критические изменения, внесенные предыдущей попыткой (например, неработающие импорты, удаленные критические файлы).
2.  **Очистка:** Удалить любые неполные или ошибочные архитектурные изменения из предыдущей попытки, которые не являются частью текущей рабочей кодовой базы.
3.  **Проверка зависимостей:** Убедиться, что `yarn.lock` стабилен, и все зависимости корректно установлены и работают. Запустить `yarn install` и проверить сборку.

### Фаза 1: Основание и первоначальная настройка
**Цель:** Создать основные структуры каталогов и конфигурации FSD и Atomic Design.
1.  **Внедрение структуры каталогов FSD:** Создать каталоги FSD верхнего уровня (`app/`, `processes/`, `pages/`, `widgets/`, `features/`, `entities/`, `shared/`) внутри `packages/frontend/src/`.
2.  **Внедрение структуры Atomic Design:** Внутри `packages/frontend/src/shared/` создать `ui/atoms/`, `ui/molecules/`, `ui/organisms/`.
3.  **Проверка алиаса `$shared`:** Убедиться, что алиас `$shared` корректно настроен в `packages/frontend/svelte.config.js` для указания на `src/shared`.
4.  **Начальная проверка сборки:** Выполнить полную сборку и базовые тесты, чтобы убедиться, что новая пустая структура не создает немедленных проблем.

### Фаза 2: Итеративная миграция компонентов (безопасная и протестированная)
**Цель:** Постепенно перенести существующие UI-компоненты в новую структуру Atomic Design внутри `shared/ui/` по одному, обеспечивая функциональность на каждом шаге.
1.  **Приоритизация критически важных компонентов:** Определить наиболее часто используемые или основополагающие UI-компоненты (например, Button, Input, Modal).
2.  **Покомпонентная миграция:** Для каждого компонента:
    *   **Создание нового компонента:** Разработать компонент в его назначенном месте (`shared/ui/atoms`, `molecules` или `organisms`), придерживаясь принципов Atomic Design и рекомендаций по совместимости со Svelte 5/Houdini.
    *   **Интеграция и тестирование:** Обновить *один* экземпляр использования компонента (например, на определенной странице) для использования нового компонента.
    *   **Проверка функциональности:** Тщательно протестировать обновленный экземпляр на полную функциональность и визуальное соответствие.
    *   **Добавление/обновление тестов:** Убедиться, что новый компонент имеет адекватные модульные и интеграционные тесты.
    *   **Частая сборка и тестирование:** После успешной миграции и тестирования каждого компонента выполнять полную сборку проекта и все тесты.
    *   **НЕ УДАЛЯТЬ СТАРЫЙ КОМПОНЕНТ:** Оригинальный файл компонента должен быть удален *только* после того, как *все* его использования будут успешно перенесены и проверены, а проект будет успешно собираться и проходить все тесты.
3.  **Порядок фокуса:** Начать с `atoms`, затем `molecules`, затем `organisms`.

### Фаза 3: Миграция функций и страниц
**Цель:** Реорганизовать существующие функции и страницы в структуру FSD.
1.  **Определение функций/страниц:** Сопоставить существующую функциональность со слоями FSD (`features/`, `entities/`, `pages/`, `widgets/`, `processes/`).
2.  **Итеративная миграция:** Переместить существующий код в соответствующие каталоги FSD.
    *   Обновить все внутренние и внешние импорты, чтобы они отражали новые пути FSD (используя `$entities`, `$features` и т. д., если алиасы настроены, или относительные пути внутри слоев).
    *   Убедиться, что логика получения данных (Houdini) и маршрутизации соответствует новой структуре.
    *   **Часто собирать и тестировать** после каждого значительного перемещения.

### Фаза 4: Документация, инструментарий и окончательный обзор
**Цель:** Завершить документацию, обеспечить соблюдение архитектурных правил и провести всесторонний обзор.
1.  **Обновление документации проекта:**
    *   Обновить `packages/frontend/README.md` обзором новой архитектуры FSD и Atomic Design.
    *   Интегрировать ключевую информацию из `FEATURE_SLICED_ATOMIC_DESIGN.md` и `COMPONENT_ARCHITECTURE_PLAN.md` Qwen в основную документацию проекта или сослаться на них соответствующим образом.
2.  **Обеспечение соблюдения архитектурных правил:** Внедрить правила ESLint или другие инструменты для обеспечения соблюдения принципов FSD и Atomic Design (например, границы слоев, правила импорта).
3.  **Всестороннее тестирование:** Провести заключительный раунд обширного тестирования, включая модульные, интеграционные, сквозные и визуальные регрессионные тесты.
4.  **Проверка кода:** Выполнить тщательную проверку кода для обеспечения соответствия новой архитектуре, качества кода и лучших практик.

## Ключевые соображения и извлеченные уроки
*   **Итеративная разработка критически важна:** Избегайте больших, монолитных изменений. Мигрируйте постепенно.
*   **Не удалять до проверки:** Никогда не удаляйте старый, рабочий код, пока его замена не будет полностью функциональна, интегрирована и тщательно протестирована.
*   **Непрерывная интеграция:** Интегрируйте этапы сборки и тестирования в рабочий процесс разработки для раннего выявления проблем.
*   **Совместимость с Houdini и Svelte 5:** Уделите пристальное внимание конкретным рекомендациям, изложенным в документации Qwen, относительно синтаксиса Svelte 5 и совместимости с Houdini.
*   **Типобезопасность:** Используйте обобщения и интерфейсы TypeScript для поддержания высокой типобезопасности на протяжении всей миграции.

## Ссылки
*   `packages/frontend/docs/FEATURE_SLICED_ATOMIC_DESIGN.md`
*   `packages/frontend/docs/COMPONENT_ARCHITECTURE_PLAN.md`
*   `.claude-qwen/completed.md` (для контекста сбоев предыдущей попытки)