# Спецификация формата исходных данных

## Формат файла source.txt

Файл `source.txt` содержит иерархические данные об аттракторах человеческого организма в формате plain text. Каждая строка представляет собой один элемент иерархии.

### Структура строки

Каждая строка в файле должна соответствовать следующему формату:
```
[идентификатор][пробел][описание][пробел][(минимальное значение)-(максимальное значение)]
```

Альтернативно:
```
[идентификатор][пробел][описание] (если нет количественных характеристик)
```

### Примеры корректных строк

```
1.	Точечные аттракторы (всего: 4000-5000)
1.1.	Молекулярный уровень (1600-2000)
1.1.1.	Концентрационные аттракторы (900-1100)
1.1.1.1.	Энергетические концентрационные аттракторы (300-350)
```

### Комментарии

Строки, начинающиеся с символа `#`, считаются комментариями и игнорируются парсером.

## Структура полей таблицы для output.json

При преобразовании JSON-файла в табличную форму, рекомендуется использовать следующую структуру:

### Основная таблица (иерархическая)

| Поле | Тип | Обязательное | Описание |
|------|-----|--------------|----------|
| id | Строка | Да | Уникальный идентификатор элемента в формате n.m.k... с завершающей точкой |
| name | Строка | Да | Наименование элемента без количественных характеристик в скобках |
| characteristic_min | Целое число | Нет | Минимальное значение количественной характеристики |
| characteristic_max | Целое число | Нет | Максимальное значение количественной характеристики |
| characteristic | Объект JSON | Нет | Объект с полями min и max; null, если характеристики нет |
| parent_id | Строка | Нет | Идентификатор родительского элемента; null для корневого элемента |
| level | Целое число | Нет | Уровень вложенности (0 - корень дерева) |
| path | Строка | Нет | Полный путь в иерархии от корня до текущего элемента |

### Дополнительные поля для аналитики

| Поле | Тип | Описание |
|------|-----|----------|
| has_children | Логическое | True, если у элемента есть дочерние элементы |
| children_count | Целое число | Количество дочерних элементов |
| is_leaf | Логическое | True, если элемент не имеет дочерних элементов |
| full_name | Строка | Полное наименование с указанием родительских элементов |

## Структура плоской таблицы (flatten)

Для аналитики может быть полезна плоская (flattened) структура, где каждый элемент иерархии представлен в отдельной строке:

| Поле | Тип | Описание |
|------|-----|----------|
| root_id | Строка | Идентификатор корневого элемента |
| level_0_id | Строка | Идентификатор элемента 0-го уровня |
| level_0_name | Строка | Название элемента 0-го уровня |
| level_1_id | Строка | Идентификатор элемента 1-го уровня |
| level_1_name | Строка | Название элемента 1-го уровня |
| ... | ... | ... |
| current_level_id | Строка | Идентификатор текущего элемента |
| current_level_name | Строка | Название текущего элемента |
| characteristic_min | Целое число | Минимальное значение характеристики |
| characteristic_max | Целое число | Максимальное значение характеристики |
| depth | Целое число | Глубина вложенности элемента |

## Соглашения об именовании и идентификаторах

1. **Идентификаторы** должны быть уникальными в пределах всего файла
2. **Иерархия** определяется количеством точек в идентификаторе
3. **Разделители** - одиночные точки между цифрами
4. **Завершающая точка** - обязательна для всех идентификаторов
5. **Разделение** между идентификатором и описанием - табуляция или один+ пробел
6. **Количественные характеристики** - в круглых скобках в конце строки

## Пример структуры таблицы в базе данных

```sql
CREATE TABLE attractors (
    id VARCHAR(50) PRIMARY KEY,
    name TEXT NOT NULL,
    parent_id VARCHAR(50),
    level INTEGER,
    characteristic_min INTEGER,
    characteristic_max INTEGER,
    path TEXT,
    has_children BOOLEAN,
    children_count INTEGER,
    FOREIGN KEY (parent_id) REFERENCES attractors(id)
);
```

## Примеры использования

Таблица может использоваться для:
1. Поиска по иерархии (например, найти все дочерние элементы для `1.1.1.`)
2. Статистического анализа (например, суммирование количественных характеристик по уровням)
3. Визуализации иерархии
4. Фильтрации по количественным характеристикам
5. Аналитики и отчетности